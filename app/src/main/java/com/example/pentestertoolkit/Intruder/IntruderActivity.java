package com.example.pentestertoolkit.Intruder;

import androidx.appcompat.app.AppCompatActivity;

import android.content.Intent;
import android.os.Bundle;
import android.util.Log;
import android.view.View;
import android.widget.Button;
import android.widget.EditText;
import android.widget.Spinner;
import android.widget.Toast;

import com.example.pentestertoolkit.Global.MySpinner;
import com.example.pentestertoolkit.R;

import java.util.regex.Matcher;
import java.util.regex.Pattern;

public class IntruderActivity extends AppCompatActivity {



    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_intruder);

        //hide action bar
        getSupportActionBar().hide();

        //UI Components
        EditText edtIntruder = findViewById(R.id.edtIntruder);
        Button btnConfigureIntruder = findViewById(R.id.btnConfigureIntruder);
        Spinner attackTypeSpinner = findViewById(R.id.int_at_spinner);


        // Show Payload Info Message

        Toast.makeText(this, "Use §§ for payloads.", Toast.LENGTH_SHORT).show();

        //Spinner Configuration
        String[] attackTypes = {"Select Attack","Sniper", "Pitch Fork","Cluster Bomb"};
        MySpinner mySpinner = new MySpinner(IntruderActivity.this, attackTypeSpinner, attackTypes);
        mySpinner.configureSpinner();


        // Transition to Intrude Activity
        btnConfigureIntruder.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View view) {

                // Input Handling
                String request = edtIntruder.getText().toString();

                if (request.isEmpty()) {
                    Toast.makeText(IntruderActivity.this, "EMPTY INPUT", Toast.LENGTH_SHORT).show();
                    return;
                }

                int payload_positions = Attack.getPayloadPositions(request);

                if (payload_positions == 0){
                    Toast.makeText(IntruderActivity.this, "0 Payload Positions", Toast.LENGTH_SHORT).show();
                    return;
                }else if(payload_positions > 5){
                    Toast.makeText(IntruderActivity.this, "Maximum 5 payload positions allowed", Toast.LENGTH_SHORT).show();
                    return;
                }

                String attackType = mySpinner.getSelectedScheme();
                if (attackType.equals("Select Attack")){
                    Toast.makeText(IntruderActivity.this, "Please Select Attack.", Toast.LENGTH_SHORT).show();
                    return;
                }

                // Transition to Configuration Activity
                Intent intrudeIntent = new Intent(IntruderActivity.this,ConfigureIntrusionActivity.class );
                intrudeIntent.putExtra("REQUEST", request);
                intrudeIntent.putExtra("ATTACK_TYPE", attackType);
                startActivity(intrudeIntent);
            }

        });



    }


}