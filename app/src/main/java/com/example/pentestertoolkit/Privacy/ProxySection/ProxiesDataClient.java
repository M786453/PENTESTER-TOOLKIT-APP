package com.example.pentestertoolkit.Privacy.ProxySection;

import android.content.Context;
import android.os.AsyncTask;
import android.util.Log;

import java.io.BufferedReader;
import java.io.InputStreamReader;
import java.net.HttpURLConnection;
import java.net.URL;

public class ProxiesDataClient extends AsyncTask<Void, Void, String> {

    private ProxiesDataCallback proxiesDataCallback;


    public ProxiesDataClient(ProxiesDataCallback proxiesDataCallback){
        this.proxiesDataCallback = proxiesDataCallback;
    }

    @Override
    protected String doInBackground(Void... voids) {
        return fetch();
    }

    @Override
    protected void onPostExecute(String s) {
        if(proxiesDataCallback != null){
            proxiesDataCallback.onProxiesDataResult(s);
        }
    }

    public static String fetch(){

        String GEO_NODE_URL = "https://proxylist.geonode.com/api/proxy-list?limit=20&page=1&sort_by=lastChecked&sort_type=desc";

        String response = "";

        try{


            //Create URL object
            URL url = new URL(GEO_NODE_URL);

            // Open Connection
            HttpURLConnection conn = (HttpURLConnection) url.openConnection();

            conn.setRequestMethod("GET");

            // Get input stream
            BufferedReader in = new BufferedReader(new InputStreamReader(conn.getInputStream()));

            // Read Input stream
            String inputLine;
            while((inputLine = in.readLine()) != null){
                response += inputLine;
            }

            in.close();
//            conn.disconnect();
        }catch (Exception e){
            e.printStackTrace();
        }

        return response;
    }

    public interface ProxiesDataCallback{

        void onProxiesDataResult(String proxies_data);

    }
}
