package com.example.pentestertoolkit.SiteMapper;

import android.os.AsyncTask;
import android.util.Log;
import android.widget.LinearLayout;

import androidx.annotation.NonNull;

import com.example.pentestertoolkit.Global.HttpData;

import org.jsoup.Jsoup;
import org.jsoup.nodes.Document;
import org.jsoup.nodes.Element;
import org.jsoup.select.Elements;

import java.util.ArrayList;

public class AutomatedSiteMapGenerator extends AsyncTask<Void, Void, Void> {

    private String site_url;

    private SiteMapCallback siteMapCallback;

    public AutomatedSiteMapGenerator(SiteMapCallback siteMapCallback, String site_url){

        this.site_url = site_url;

        this.siteMapCallback = siteMapCallback;

    }

    @Override
    protected Void doInBackground(Void... voids) {

        generateSiteMap();

        return null;
    }

    @Override
    protected void onPostExecute(Void unused) {
        if (siteMapCallback != null)
            siteMapCallback.OnSiteMapGenerated();
    }

    private void generateSiteMap(){


        try{

            Document site_doc = Jsoup.connect(site_url).get();

            Elements link_elements = site_doc.select("a[href]");

            for (Element link: link_elements){

                String href = link.attr("href");

                if (!href.startsWith("#") && !href.startsWith("mailto:") && !href.startsWith("tel:") && !href.isEmpty()){

                    if (href.contains("http://") || href.contains("https://"))
                        href = href.split("://")[1];

                    if (href.contains("www"))
                        href = href.split("www.")[1];

                    HttpData.linkClassifier.addLink(href);

                }

            }

        }catch (Exception e){
            e.printStackTrace();
        }

    }


    public interface SiteMapCallback{

        void OnSiteMapGenerated();

    }



}
