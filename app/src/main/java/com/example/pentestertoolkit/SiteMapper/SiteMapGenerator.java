package com.example.pentestertoolkit.SiteMapper;

import android.os.AsyncTask;
import android.util.Log;

import org.jsoup.Jsoup;
import org.jsoup.nodes.Document;
import org.jsoup.nodes.Element;
import org.jsoup.select.Elements;

import java.util.ArrayList;

public class SiteMapGenerator extends AsyncTask<Void, Void, Void> {

    private String site_url;

    private LinkClassifier linkClassifier;

    public SiteMapGenerator(String site_url){

        this.site_url = site_url;

        linkClassifier = new LinkClassifier();

    }


    @Override
    protected Void doInBackground(Void... voids) {

        generateSiteMap();

        linkClassifier.printHierarchy();

        return null;
    }

    private void generateSiteMap(){

//        ArrayList<String> links_list = new ArrayList<>();

        try{

            Document site_doc = Jsoup.connect(site_url).get();

            Elements link_elements = site_doc.select("a[href]");

            for (Element link: link_elements){

                String href = link.attr("href");

                if (!href.startsWith("#") && !href.startsWith("mailto:") && !href.startsWith("tel:") && !href.isEmpty()){

                    if (href.contains("http://") || href.contains("https://"))
                        href = href.split("//")[1];

                    if (href.contains("www"))
                        href = href.split("www.")[1];

//                    links_list.add(href);
                    linkClassifier.addLink(href);
//                    Log.i("LINK: ", href);
                }

            }

        }catch (Exception e){
            e.printStackTrace();
        }
//        return links_list;
    }



}
