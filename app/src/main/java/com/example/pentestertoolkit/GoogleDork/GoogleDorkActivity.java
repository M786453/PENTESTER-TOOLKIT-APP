package com.example.pentestertoolkit.GoogleDork;

import androidx.appcompat.app.AppCompatActivity;

import android.app.ProgressDialog;
import android.media.Image;
import android.os.Bundle;
import android.util.Log;
import android.view.View;
import android.widget.AdapterView;
import android.widget.ArrayAdapter;
import android.widget.Button;
import android.widget.EditText;
import android.widget.ImageView;
import android.widget.ListView;
import android.widget.TextView;
import android.widget.Toast;

import com.example.pentestertoolkit.Global.CopyText;
import com.example.pentestertoolkit.R;

import java.io.BufferedReader;
import java.io.Console;
import java.io.InputStreamReader;
import java.net.HttpURLConnection;
import java.net.URL;
import java.util.ArrayList;
import java.util.HashMap;

public class GoogleDorkActivity extends AppCompatActivity{

    private ListView dork_results_listview;

    private ArrayList<String> all_scraped_links;

    private ArrayAdapter<String> scraped_links_adapter;

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_google_dork);

        getSupportActionBar().hide();

        all_scraped_links = new ArrayList<>();

        scraped_links_adapter = new ArrayAdapter<>(GoogleDorkActivity.this, R.layout.listview_item_google_dork,R.id.txtGoogleDork, all_scraped_links);


        // Initialize UI Components
        EditText edtSearchQuery = findViewById(R.id.edt_google_dork_query);
        ImageView imgSettings = findViewById(R.id.img_settings_google_dork);
        dork_results_listview = findViewById(R.id.scraped_links_listview);

        //set adapter to listview
        dork_results_listview.setAdapter(scraped_links_adapter);


        imgSettings.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View view) {

                    String query = edtSearchQuery.getText().toString();

                    if (query.isEmpty()){
                        Toast.makeText(GoogleDorkActivity.this, "EMPTY QUERY", Toast.LENGTH_SHORT).show();
                        return;
                    }

                    Toast.makeText(GoogleDorkActivity.this, "Searching...", Toast.LENGTH_LONG).show();
                    GoogleDorker googleDorker = new GoogleDorker(dork_results_listview, scraped_links_adapter ,all_scraped_links ,query);
                    googleDorker.execute();
            }
        });


        dork_results_listview.setOnItemLongClickListener(new AdapterView.OnItemLongClickListener() {
            @Override
            public boolean onItemLongClick(AdapterView<?> adapterView, View view, int i, long l) {
                TextView txtLink = view.findViewById(R.id.txtGoogleDork);
                CopyText.copy(GoogleDorkActivity.this, txtLink.getText().toString());
                Toast.makeText(GoogleDorkActivity.this, "Copied!", Toast.LENGTH_SHORT).show();
                return true;
            }
        });

    }
}